<project xmlns:ivy="antlib:org.apache.ivy.ant"
    xmlns:if="ant:if"
    xmlns:unless="ant:unless"
    xmlns:au="antlib:org.apache.ant.antunit">

    <description>
        Base project applying antunit conventions to build.
    </description>

    <property name="reports.antunit.dir" location="${reports.dir}/antunit"/>

    <property name="src.antunit.dir" location="${src.dir}/antunit"/>
    <property name="src.antunit.ant.dir" location="${src.antunit.dir}/ant"/>
    <property name="build.antunit.dir" location="${build.dir}/antunit"/>

    <extension-point name="prepareAntUnit"/>

    <target name="configureAntUnit" extensionOf="configure">
        <taskdef resource="org/apache/ant/antunit/antlib.xml" uri="antlib:org.apache.ant.antunit"
	    classpathref="build.classpath"/>
    </target>

    <target name="moveToBuild" extensionOf="prepareAntUnit">
        <copy toDir="${build.antunit.dir}">
            <fileset dir="${src.antunit.ant.dir}"/>
        </copy>
    </target>

    <target name="testAntUnit" depends="prepareAntUnit" extensionOf="test">
        <mkdir dir="${build.test.results.dir}"/>
        <au:antunit>
            <fileset dir="${build.antunit.dir}">
                <include name="**/*-test.xml"/>
            </fileset>
            <au:plainlistener logLevel="error"/>
            <au:xmllistener todir="${build.test.results.dir}"/>
            <propertyset>
                <propertyref prefix="antunit"/>
            </propertyset>
        </au:antunit>
        <delete dir="${reports.antunit.dir}"/>
        <mkdir dir="${reports.antunit.dir}"/>
        <junitreport todir="${build.test.results.dir}">
            <fileset dir="${build.test.results.dir}">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="frames" todir="${reports.antunit.dir}/html"/>
        </junitreport>
    </target>
</project>
